# 安全措施说明

本文件总结系统当前已落实的安全措施与约束，便于审计与对照检查。

## 认证与登录

- **Passkey/TOTP 优先**：系统支持 Passkey 与 TOTP 二次认证，管理员/审核人员/教师必须使用 Passkey 或 TOTP 登录。
- **密码登录限制**：仅学生允许使用密码登录，且是否允许由管理员控制。
- **首次登录强制改密**：学生首次登录或重置密码后强制修改密码才能进入系统。
- **重置通道受控**：非学生不支持自助找回，由管理员发送一次性重置码或重置链接（有效期 24 小时）。

## 权限与访问控制

- **基于角色的鉴权**：管理员/审核员/教师/学生权限隔离。
- **敏感接口仅管理员可用**：包括用户管理、模板配置、导入、删除与彻底删除等功能。
- **附件下载校验**：学生仅可访问自己的附件；审核人员/教师/管理员可查看相关附件。

## 数据保护与软删除

- **软删除机制**：对学生与记录的删除使用 `is_deleted` 标记，避免直接删除造成审计缺失。
- **彻底删除受限**：仅管理员可在“清理已删除”页面执行彻底删除。
- **导出脱敏**：导出模板由管理员配置，系统仅替换合法占位符。

## 密钥与证书

- **敏感密钥必须配置**：`AUTH_SECRET_KEY` 与 `TLS_KEY_ENC_KEY` 必须提供 Base64 32 字节密钥。
- **TLS 私钥加密存储**：TLS 私钥落盘前使用 AES-256 加密。
- **可导入证书**：支持导入外部证书/私钥，避免使用默认自签证书。

## 文件与上传

- **附件类型限制**：仅允许 PDF 与图片格式上传。
- **大小限制**：附件与签名均有大小上限，超限直接拒绝。
- **存储隔离**：上传文件按类型分目录存储，文件名进行净化与规范化处理。

## 会话与传输

- **会话 Cookie**：服务端使用 Cookie 管理会话，配置项可调整过期时间与名称。
- **开发模式隔离**：开发模式使用默认配置并允许 HTTP，生产建议关闭 `ALLOW_HTTP` 并使用反向代理终止 HTTPS。

## 依赖与风险提示

- **LibreOffice**：用于导出 PDF，需确保容器/主机安装并可调用 `soffice`。
- **日志**：当前日志为基础级别，生产环境建议集中化收集。

如需更严格的安全策略（例如审计日志、IP 白名单、MFA 强制策略细化等），可在此基础上继续扩展。
